---
output:
    github_document:
        html_preview: false
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  eval = FALSE
)
```

# CAMDAC

Copy-number Aware Methylation Deconvolution Analysis of Cancer (CAMDAC) is an R library for deconvolving pure tumor methylation from bulk tumor sequencing data ([Larose Cadieux et al., 2022, bioXriv](https://www.biorxiv.org/content/10.1101/2020.11.03.366252v2)).

This branch performs CAMDAC analysis for whole genome bisulfite sequencing (WGBS) data. For Reduced Representation Bisulfite Sequencing (RRBS) data analysis, visit the [VanLoo-lab/CAMDAC main branch](https://github.com/VanLoo-lab/CAMDAC/tree/main).

<!-- badges: start -->
<!-- badges: end -->

## Documentation

View the full documentation at [https://vanloo-lab.github.io/CAMDAC/](https://vanloo-lab.github.io/CAMDAC/).

## Quickstart

CAMDAC can be installed from an R console:

``` r
remotes::install_github("VanLoo-lab/CAMDAC@wgbs")
CAMDAC::download_pipeline_files("wgbs", directory = "./refs")
```

To run the tumor-normal deconvolution pipeline:

```{r example}
library(CAMDAC)

# Download pipeline files for WGBS or RRBS analysis
# File URLs are listed in inst/extdata/pipeline_files_urls.txt
CAMDAC::download_pipeline_files(bsseq = "rrbs", directory = "./refs")
CAMDAC::download_pipeline_files(bsseq = "wgbs", directory = "./refs")

# Load test data paths
tumor_bam <- system.file("testdata", "tumor.bam", package = "CAMDAC")
normal_bam <- system.file("testdata", "normal.bam", package = "CAMDAC")

# Setup pipeline for basic tumor-normal analysis
tumor <- CamSample(id = "T", sex = "XY", bam = tumor_bam)
normal <- CamSample(id = "N", sex = "XY", bam = normal_bam)
config <- CamConfig(
  outdir = "./results", bsseq = "rrbs", lib = "pe",
  build = "hg38", refs = "./refs", n_cores = 1, cna_caller='ascat'
)

# Run CAMDAC ppeline
CAMDAC::pipeline(
  tumor, germline = normal, infiltrates = normal, origin = normal, config
)
```

For a more detailed walkthrough with test data, see `vignette("pipeline")`.

## Development

```{r}
library(devtools)
devtools::install_dev_deps("VanLoo-lab/CAMDAC@wgbs")

# After updating code:
# Update docs
devtools::document()
# Run tests
devtools::test()
# Build readme
devtools::build_readme()
# Check package builds
devtools::check()
# Build documentation
pkgdown::build_site(preview=FALSE)
```
